<div ng-init="init()">

<!-- 3. Panel Component -->
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">RSVP for {{ getDisplayDate(date) }}</h3>
  </div>
  <div class="panel-body">

    <!-- Validation Error -->
    <div class="alert alert-danger validation-error" ng-show="statsError">
      <span class="glyphicon glyphicon-exclamation-sign"></span>
      {{ statsError }}
    </div>

    <!-- Summary Stats -->
    <div class="summary-stats" ng-hide="o.niyaz">
      <span class="stat-badge stat-badge-rsvp">
        {{ stats.total }} RSVP
      </span>
      <div class="stat-group">
        <span class="stat-badge stat-badge-tiffin">
          {{ stats.tiffin }}
          <span class="glyphicon glyphicon-leaf"></span>
          TIFFIN
        </span>
        <span class="stat-divider">|</span>
        <span class="stat-badge stat-badge-togo">
          {{ stats.togo }}
          <span class="glyphicon glyphicon-eye-open"></span>
          TOGO
        </span>
      </div>
      <div class="stat-group">
        <span class="stat-badge stat-badge-done">
          {{ stats.done }}
          <span class="glyphicon glyphicon-thumbs-up"></span>
          DONE
        </span>
        <span class="stat-divider">|</span>
        <span class="stat-badge stat-badge-remains">
          {{ stats.remains }}
          <span class="glyphicon glyphicon-thumbs-down"></span>
          REMAINS
        </span>
      </div>
    </div>

    <!-- Size Distribution -->
    <div class="size-dist">
      <span class="size-badge" ng-repeat="size in ['XL', 'LG', 'MD', 'SM', 'XS']"
            ng-class="{
              'label-primary': size === 'XL',
              'label-success': size === 'LG',
              'label-info': size === 'MD',
              'label-warning': size === 'SM',
              'label-danger': size === 'XS'
            }">
        {{size}}: {{sizeStats[size]}}
      </span>
    </div>

    <!-- Menu Info -->
    <div class="menu-info text-right">
      <span ng-repeat="(menu, ingred) in o.serving">
        {{ menu }}:
        <span ng-repeat="q in ingred" class="label label-info" style="margin-right: 5px">{{ q }}</span>
      </span>
    </div>

    <!-- Main Table -->
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr class="sort-row">
            <th class="col-xs-1">
              <span class="sort-badge" ng-class="{'sort-active': sortColumn === 'thaali'}" ng-click="setSortColumn('thaali')">
                THAALI <span class="sort-indicator glyphicon" ng-class="{'glyphicon-chevron-up': sortColumn === 'thaali' && sortAscending, 'glyphicon-chevron-down': sortColumn === 'thaali' && !sortAscending}"></span>
              </span>
            </th>
            <th class="col-xs-1">
              <span class="sort-badge" ng-class="{'sort-active': sortColumn === 'area'}" ng-click="setSortColumn('area')">
                AREA <span class="sort-indicator glyphicon" ng-class="{'glyphicon-chevron-up': sortColumn === 'area' && sortAscending, 'glyphicon-chevron-down': sortColumn === 'area' && !sortAscending}"></span>
              </span>
            </th>
            <th class="col-xs-1" ng-hide="o.niyaz">
              <span class="sort-badge" ng-class="{'sort-active': sortColumn === 'here'}" ng-click="setSortColumn('here')">
                TIFFIN <span class="sort-indicator glyphicon" ng-class="{'glyphicon-chevron-up': sortColumn === 'here' && sortAscending, 'glyphicon-chevron-down': sortColumn === 'here' && !sortAscending}"></span>
              </span>
            </th>
            <th class="col-xs-1">
              <span class="sort-badge" ng-class="{'sort-active': sortColumn === 'size'}" ng-click="setSortColumn('size')">
                SIZE <span class="sort-indicator glyphicon" ng-class="{'glyphicon-chevron-up': sortColumn === 'size' && sortAscending, 'glyphicon-chevron-down': sortColumn === 'size' && !sortAscending}"></span>
              </span>
            </th>
            <th class="col-xs-1" ng-hide="o.niyaz">
              <span class="sort-badge" ng-class="{'sort-active': sortColumn === 'bread+rice'}" ng-click="setSortColumn('bread+rice')">
                RICE|BREAD <span class="sort-indicator glyphicon" ng-class="{'glyphicon-chevron-up': sortColumn === 'bread+rice' && sortAscending, 'glyphicon-chevron-down': sortColumn === 'bread+rice' && !sortAscending}"></span>
              </span>
            </th>
            <th class="col-xs-1" ng-hide="o.niyaz">
              <span class="sort-badge" ng-class="{'sort-active': sortColumn === 'filled'}" ng-click="setSortColumn('filled')">
                DONE <span class="sort-indicator glyphicon" ng-class="{'glyphicon-chevron-up': sortColumn === 'filled' && sortAscending, 'glyphicon-chevron-down': sortColumn === 'filled' && !sortAscending}"></span>
              </span>
            </th>
            <th>
              <span class="sort-badge" ng-class="{'sort-active': sortColumn === 'name'}" ng-click="setSortColumn('name')">
                NAME <span class="sort-indicator glyphicon" ng-class="{'glyphicon-chevron-up': sortColumn === 'name' && sortAscending, 'glyphicon-chevron-down': sortColumn === 'name' && !sortAscending}"></span>
              </span>
            </th>
          </tr>
          <tr class="filter-row">
            <th class="col-xs-1">
              <input ng-model='filterNames.thaali' type="text" class="form-control"
                     ng-change="onFilterChange()" placeholder="THAALI">
            </th>
            <th class="col-xs-1">
              <input ng-model='filterNames.area' type="text" class="form-control"
                     ng-change="onFilterChange()" placeholder="AREA">
            </th>
            <th class="col-xs-1" ng-hide="o.niyaz">
              <input ng-model='filterNames.here' type="text" class="form-control"
                     ng-change="onFilterChange()" placeholder="TIFFIN">
            </th>
            <th class="col-xs-1">
              <input ng-model='filterNames.size' type="text" class="form-control"
                     ng-change="onFilterChange()" placeholder="SIZE">
            </th>
            <th class="col-xs-1" ng-hide="o.niyaz">
              <input ng-model='filterNames.rice' type="text" class="form-control"
                     ng-change="onFilterChange()" placeholder="RICE|BREAD">
            </th>
            <th class="col-xs-1" ng-hide="o.niyaz">
              <input ng-model='filterNames.filled' type="text" class="form-control"
                     ng-change="onFilterChange()" placeholder="DONE">
            </th>
            <th>
              <input ng-model='filterNames.name' type="text" class="form-control"
                     ng-change="onFilterChange()" placeholder="NAME">
            </th>
          </tr>
        </thead>
        <tbody id="rTab">
          <tr ng-repeat="item in raw | orderBy: sorterFunc | filter: filterFunc">
            <td>
              <span class="badge-thaali">{{ item["thaali"] }}</span>
            </td>
            <td>
              <span class="badge-area">{{ item["area"].substring(0, 2) }}</span>
            </td>
            <td ng-hide="o.niyaz">
              <input type="checkbox" ng-model='item.here' ng-checked="item.here==1"
                     ng-click="onCheckboxClick(item, 'here')">
            </td>
            <!-- Size column with custom colors -->
            <td>
              <span class="label size-label"
                    ng-class="{
                      'label-danger': item.size === 'XS',
                      'label-warning': item.size === 'SM',
                      'label-info': item.size === 'MD',
                      'label-success': item.size === 'LG',
                      'label-primary': item.size === 'XL'
                    }"
                    data-toggle="tooltip"
                    title="Thaali Size">
                {{ item["size"] }}
              </span>
            </td>
            <td ng-hide="o.niyaz">{{ item["bread+rice"] }}</td>
            <td ng-hide="o.niyaz">
              <input type="checkbox" ng-model='item.filled' ng-checked="item.filled==1"
                     ng-click="onCheckboxClick(item, 'filled')">
            </td>
            <td>{{ item["name"] }}</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
  <div class="panel-footer">
    <!-- 6. Enhanced Navigation Buttons -->
    <div class="noPrnt text-center">
      <div class="btn-group">
        <button class="btn btn-default" ng-click="next(-1)">
          <span class="glyphicon glyphicon-chevron-left"></span> Prev
        </button>
        <button class="btn btn-warning" ng-show="o.save" ng-click="reset(document.getElementsByTagName('input'))">
          <span class="glyphicon glyphicon-refresh"></span> Reset
        </button>
        <button class="btn btn-success" ng-disabled="!changed" ng-show="o.save" ng-click="submit()">
          <span class="glyphicon glyphicon-save"></span> Save
        </button>
        <button class="btn btn-default" ng-click="next(1)">
          Next <span class="glyphicon glyphicon-chevron-right"></span>
        </button>
      </div>
    </div>
  </div>
</div>

</div>